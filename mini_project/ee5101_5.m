clc
clear all
syms s;
a = 0;
b = 0;
c = 4;
d = 5;
B = [0.0564+(b/(10+c)) ,0.0319;
0.0165-(c+d-5)/(1000+20*a),-0.02;
4.4939,1.5985*(a+10)/(b+12);
-1.4269,0.2730];
A =[-8.8487+(a-b)/5  -0.0399  -5.5500+(c+d)/10   3.5846;
    -4.5740       2.5010*((d+5)/(c+5))  -4.3662  -1.1183-(a-c)/20;
    3.7698      16.1212-c/5    -18.2103+(a+d)/(b+4)  4.4936;
    -8.5645-(a-b)/(c+d+2) 8.3742  -4.4331      -7.7181*(c+5)/(b+5)];
C = [-3.2988, -2.1932+(10*c +d)/(100+5*a) ,0.0370 ,-0.0109;
    0.2922-(a*b)/500,  -2.1506,   -0.0104,  0.0163];
x0 = [0.5 -0.1 0.3 -0.8]';

A_ = [A,zeros(4,2);-C,zeros(2,2)];
B_ = [B;zeros(2,2)];
q =[10 50 50 50 30 10];
Q = diag(q);
r = [0.1 0.1];
R = diag(r);
R_1 = inv(R);
gamma=[A_,-B_*(R_1)*B_';-Q,-A_'];
[x,y]=eig(gamma);
y=diag(y);
k=1;
for i=1:length(y)
    if(y(i)<0)
        v(:,k)=x(1:6,i);
        mu(:,k)=x(7:12,i);
        k=k+1;
    end
end
v_1 = inv(v);
P = mu/v
K1 = R\B_'*P

k1 = K1(:,1:4);
k2 = K1(:,5:6);
A1 = A - B*k1;
[x_1,y_1] = eig(A1);
s0 = 1;
s1 = 2;
s2 = 3;
s3 = 4;
B_1 = C';
wc = [B_1 A'*B_1 A'*A'*B_1 A'*A'*A'*B_1];
C_ = [wc(1:4,1) wc(1:4,3) wc(1:4,2) wc(1:4,4)];

C_inv = inv(C_);
q_d1_T = C_inv(2,:);
q_d1d2_T = C_inv(4,:);
q_d1_T_A = q_d1_T * A';
q_d1d2_T_A = q_d1d2_T * A';
T = [q_d1_T;q_d1_T_A ;q_d1d2_T;q_d1d2_T_A];
A_ba = T*A'*inv(T);
B_ba = T * B_1;

m = (s-s0)*(s-s1)*(s-s2)*(s-s3);
a = expand(m)
Ad_1 = [0 1 0 0 ;
    0 0 1 0;
    0 0 0 1;
    -24 50 -35 10]; 
H_ba_1 = B_ba\(A_ba-Ad_1);
H_1 = H_ba_1*T;
H = H_1'



